<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>スコアトラッカー</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Mochiy+Pop+One&family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* ポップで読みやすいフォントを設定 */
        body {
            font-family: 'Inter', 'Mochiy Pop One', sans-serif;
            overscroll-behavior: none; /* スクロールでの画面のバウンスを無効化 */
        }
        
        /* 入力フィールドのスタイル */
        .score-input::-webkit-outer-spin-button,
        .score-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .score-input[type=number] {
            -moz-appearance: textfield;
        }

        /* 紙吹雪のスタイル */
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #f00;
            opacity: 0.7;
            border-radius: 50%;
            animation: fall 3s linear forwards;
        }

        /* 紙吹雪のアニメーション */
        @keyframes fall {
            0% {
                transform: translateY(-10vh) rotate(0deg);
            }
            100% {
                transform: translateY(110vh) rotate(720deg);
            }
        }
    </style>
</head>
<body class="bg-gray-100 h-screen flex flex-col items-center justify-center p-2">

    <h1 class="text-3xl font-bold text-gray-800 mb-2 flex-shrink-0" style="font-family: 'Mochiy Pop One', sans-serif;">スコアトラッカー</h1>

    <!-- 優勢バー -->
    <div class="w-full max-w-6xl mb-2 flex-shrink-0">
        <div class="flex h-6 rounded-full overflow-hidden bg-gray-300 shadow-inner">
            <div id="progress-bar-0" class="bg-blue-500 transition-all duration-500 ease-in-out" style="width: 50%;"></div>
            <div id="progress-bar-1" class="bg-red-500 transition-all duration-500 ease-in-out" style="width: 50%;"></div>
        </div>
    </div>

    <!-- チーム表示エリア -->
    <div id="teams-wrapper" class="w-full max-w-6xl flex-grow flex rounded-2xl overflow-hidden shadow-2xl bg-gray-200 min-h-0">
        <!-- チーム1 -->
        <div id="team-0-container" class="w-1/2 bg-blue-500 p-3 flex flex-col items-center">
            <input type="text" id="team-0-name" value="あおチーム" class="text-3xl font-bold text-white bg-transparent text-center rounded-lg p-2 mb-1 w-full focus:outline-none focus:ring-2 focus:ring-white flex-shrink-0" placeholder="チーム名を入力">
            <div class="text-7xl font-bold text-white mb-2 flex-shrink-0" id="team-0-total-score">0</div>
            <div id="team-0-members" class="w-full flex-grow overflow-y-auto pr-2"></div>
            <div class="mt-auto pt-2 w-full flex-shrink-0">
                <div class="flex gap-2">
                    <input type="text" id="member-name-0" class="w-full px-3 py-2 rounded-lg border-2 border-blue-200 focus:outline-none focus:ring-2 focus:ring-white" placeholder="メンバーの名前">
                    <button onclick="addMember(0)" class="bg-white text-blue-500 font-bold py-2 px-4 rounded-lg shadow-md hover:bg-blue-50 transition-transform transform hover:scale-105">追加</button>
                </div>
            </div>
        </div>

        <!-- チーム2 -->
        <div id="team-1-container" class="w-1/2 bg-red-500 p-3 flex flex-col items-center">
            <input type="text" id="team-1-name" value="あかチーム" class="text-3xl font-bold text-white bg-transparent text-center rounded-lg p-2 mb-1 w-full focus:outline-none focus:ring-2 focus:ring-white flex-shrink-0" placeholder="チーム名を入力">
            <div class="text-7xl font-bold text-white mb-2 flex-shrink-0" id="team-1-total-score">0</div>
            <div id="team-1-members" class="w-full flex-grow overflow-y-auto pr-2"></div>
            <div class="mt-auto pt-2 w-full flex-shrink-0">
                <div class="flex gap-2">
                    <input type="text" id="member-name-1" class="w-full px-3 py-2 rounded-lg border-2 border-red-200 focus:outline-none focus:ring-2 focus:ring-white" placeholder="メンバーの名前">
                    <button onclick="addMember(1)" class="bg-white text-red-500 font-bold py-2 px-4 rounded-lg shadow-md hover:bg-red-50 transition-transform transform hover:scale-105">追加</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 操作ボタンエリア -->
    <div class="flex gap-4 mt-4 flex-shrink-0">
        <button onclick="resetScores()" class="bg-yellow-500 text-white font-bold py-3 px-8 rounded-full shadow-lg hover:bg-yellow-600 transition-transform transform hover:scale-105 text-lg">
            点数リセット
        </button>
        <button onclick="endGame()" class="bg-green-500 text-white font-bold py-3 px-8 rounded-full shadow-lg hover:bg-green-600 transition-transform transform hover:scale-105 text-lg">
            ゲーム終了！
        </button>
    </div>

    <!-- 結果発表モーダル -->
    <div id="result-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50">
        <div id="result-box" class="bg-white p-10 rounded-3xl shadow-2xl text-center transform scale-0 transition-transform duration-500 ease-in-out">
            <h2 id="result-title" class="text-5xl font-bold mb-4" style="font-family: 'Mochiy Pop One', sans-serif;"></h2>
            <p id="result-message" class="text-2xl text-gray-700"></p>
            <p id="result-score" class="text-7xl font-bold my-6"></p>
            <button onclick="closeModal()" class="mt-6 bg-green-500 text-white font-bold py-3 px-8 rounded-full shadow-lg hover:bg-green-600 transition-transform transform hover:scale-105 text-lg">
                もう一回！
            </button>
        </div>
    </div>

    <script>
        // チームのデータを管理するオブジェクト
        let teams = [
            { name: 'あおチーム', members: [], totalScore: 0 },
            { name: 'あかチーム', members: [], totalScore: 0 }
        ];

        // 初期表示を行う
        document.addEventListener('DOMContentLoaded', () => {
            renderAll();
            setupTeamNameListeners();
        });

        // チーム名入力のイベントリスナーを設定
        function setupTeamNameListeners() {
            document.getElementById('team-0-name').addEventListener('input', (e) => {
                teams[0].name = e.target.value;
            });
            document.getElementById('team-1-name').addEventListener('input', (e) => {
                teams[1].name = e.target.value;
            });
        }
        
        // すべての表示を更新する
        function renderAll() {
            calculateTotalScores();
            renderMembers();
            updateProgressBar();
        }

        // メンバーリストの表示を更新する
        function renderMembers() {
            teams.forEach((team, teamIndex) => {
                const membersContainer = document.getElementById(`team-${teamIndex}-members`);
                membersContainer.innerHTML = ''; // 一旦空にする
                
                const memberListWrapper = document.createElement('div');

                // メンバーが6人以上になったら2列にする
                if (team.members.length > 5) {
                    memberListWrapper.className = 'grid grid-cols-2 gap-2';
                } else {
                    memberListWrapper.className = 'space-y-2';
                }

                team.members.forEach((member, memberIndex) => {
                    const memberDiv = document.createElement('div');
                    memberDiv.className = 'flex items-center justify-between bg-white bg-opacity-30 rounded-lg p-2 shadow';
                    
                    const memberName = document.createElement('span');
                    // 2列表示の際はフォントを少し小さくする
                    const nameFontSize = team.members.length > 5 ? 'text-base' : 'text-lg';
                    memberName.className = `text-white font-semibold flex-grow ${nameFontSize}`;
                    memberName.textContent = member.name;
                    
                    const scoreControls = document.createElement('div');
                    scoreControls.className = 'flex items-center gap-1 flex-shrink-0';

                    const minusButton = document.createElement('button');
                    minusButton.textContent = '－';
                    minusButton.className = 'w-6 h-6 bg-white text-gray-700 font-bold rounded-full shadow hover:bg-gray-100 flex items-center justify-center transition-transform transform hover:scale-110';
                    minusButton.onclick = () => changeScore(teamIndex, memberIndex, -1);

                    const scoreInput = document.createElement('input');
                    scoreInput.type = 'number';
                    scoreInput.className = 'score-input w-12 text-center text-lg font-bold bg-white rounded-md p-1 shadow-inner';
                    scoreInput.value = member.score;
                    scoreInput.min = "0"; // マイナス点を入力できないように
                    scoreInput.addEventListener('input', (e) => {
                        const value = parseInt(e.target.value, 10);
                        if (isNaN(value) || value < 0) {
                            member.score = 0;
                            e.target.value = 0;
                        } else {
                            member.score = value;
                        }
                        renderAll();
                    });

                    const plusButton = document.createElement('button');
                    plusButton.textContent = '＋';
                    plusButton.className = 'w-6 h-6 bg-white text-gray-700 font-bold rounded-full shadow hover:bg-gray-100 flex items-center justify-center transition-transform transform hover:scale-110';
                    plusButton.onclick = () => changeScore(teamIndex, memberIndex, 1);

                    const deleteButton = document.createElement('button');
                    deleteButton.textContent = '✕';
                    deleteButton.className = 'mr-2 text-white font-bold hover:text-red-200 text-xl';
                    deleteButton.onclick = () => {
                        deleteMember(teamIndex, memberIndex);
                    };

                    scoreControls.appendChild(minusButton);
                    scoreControls.appendChild(scoreInput);
                    scoreControls.appendChild(plusButton);
                    
                    memberDiv.appendChild(deleteButton); // ✕ボタンを左に
                    memberDiv.appendChild(memberName);
                    memberDiv.appendChild(scoreControls);
                    memberListWrapper.appendChild(memberDiv);
                });
                membersContainer.appendChild(memberListWrapper);
            });
        }
        
        // メンバーを追加する
        function addMember(teamIndex) {
            const nameInput = document.getElementById(`member-name-${teamIndex}`);
            const name = nameInput.value.trim();
            if (name) {
                teams[teamIndex].members.push({ name: name, score: 0 });
                nameInput.value = '';
                renderAll();
            }
        }

        // スコアを変更する
        function changeScore(teamIndex, memberIndex, amount) {
            const newScore = teams[teamIndex].members[memberIndex].score + amount;
            // スコアがマイナスにならないようにする
            teams[teamIndex].members[memberIndex].score = Math.max(0, newScore);
            renderAll();
        }

        // メンバーを削除する
        function deleteMember(teamIndex, memberIndex) {
            teams[teamIndex].members.splice(memberIndex, 1);
            renderAll();
        }

        // 合計点を計算する
        function calculateTotalScores() {
            teams.forEach((team, teamIndex) => {
                const total = team.members.reduce((sum, member) => sum + member.score, 0);
                team.totalScore = total;
                document.getElementById(`team-${teamIndex}-total-score`).textContent = total;
            });
        }

        // 優勢バーを更新する
        function updateProgressBar() {
            const totalScore1 = teams[0].totalScore;
            const totalScore2 = teams[1].totalScore;
            const grandTotal = totalScore1 + totalScore2;

            const progressBar1 = document.getElementById('progress-bar-0');
            const progressBar2 = document.getElementById('progress-bar-1');

            if (grandTotal === 0) {
                progressBar1.style.width = '50%';
                progressBar2.style.width = '50%';
            } else {
                const percentage1 = (totalScore1 / grandTotal) * 100;
                progressBar1.style.width = `${percentage1}%`;
                progressBar2.style.width = `${100 - percentage1}%`;
            }
        }
        
        // 点数をリセットする
        function resetScores() {
            teams.forEach(team => {
                team.members.forEach(member => {
                    member.score = 0;
                });
            });
            renderAll();
        }

        // ゲームを終了し、結果を発表する
        function endGame() {
            const score1 = teams[0].totalScore;
            const score2 = teams[1].totalScore;

            const modal = document.getElementById('result-modal');
            const resultBox = document.getElementById('result-box');
            const title = document.getElementById('result-title');
            const message = document.getElementById('result-message');
            const scoreDisplay = document.getElementById('result-score');
            
            // 以前のスタイルをクリア
            title.style.color = '';
            scoreDisplay.style.color = '';
            scoreDisplay.innerHTML = '';
            
            if (score1 === score2) { // 引き分けの場合
                title.textContent = "ひきわけ！";
                message.textContent = "どっちのチームもがんばったね！";
                scoreDisplay.textContent = `${score1} - ${score2}`;
                resultBox.style.borderColor = '#fbbf24'; // yellow-400
                title.style.color = '#ca8a04'; // yellow-600
                scoreDisplay.style.color = '#ca8a04'; // yellow-600
            } else { // 勝敗が決まった場合
                let winner, winnerColor, winnerBorderColor;
                let score1Color, score2Color;
                const blackColor = '#1f2937'; // gray-800

                if (score1 > score2) { // チーム1（あお）の勝ち
                    winner = teams[0];
                    winnerColor = '#2563eb'; // blue-600
                    winnerBorderColor = '#3b82f6'; // blue-500
                    score1Color = winnerColor;
                    score2Color = blackColor;
                } else { // チーム2（あか）の勝ち
                    winner = teams[1];
                    winnerColor = '#dc2626'; // red-600
                    winnerBorderColor = '#ef4444'; // red-500
                    score1Color = blackColor;
                    score2Color = winnerColor;
                }
                
                title.textContent = `${winner.name}のかち！`;
                message.textContent = "おめでとう！やったね！";
                title.style.color = winnerColor;
                resultBox.style.borderColor = winnerBorderColor;
                
                // 常にチーム1、チーム2の順番でスコアを表示
                scoreDisplay.innerHTML = `<span style="color: ${score1Color};">${score1}</span><span style="color: ${blackColor};"> - </span><span style="color: ${score2Color};">${score2}</span>`;
            }

            resultBox.classList.add('border-8');
            modal.classList.remove('hidden');
            setTimeout(() => {
                resultBox.classList.remove('scale-0');
                resultBox.classList.add('scale-100');
                launchConfetti();
            }, 10);
        }

        // モーダルを閉じる
        function closeModal() {
            const modal = document.getElementById('result-modal');
            const resultBox = document.getElementById('result-box');
            resultBox.classList.remove('scale-100');
            resultBox.classList.add('scale-0');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 500);
        }

        // 紙吹雪を飛ばす
        function launchConfetti() {
            const colors = ['#ef4444', '#3b82f6', '#fbbf24', '#34d399', '#a78bfa'];
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = `${Math.random() * 100}vw`;
                confetti.style.animationDelay = `${Math.random() * 2}s`;
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.transform = `scale(${Math.random() * 0.8 + 0.5})`; // 大きさもランダムに
                document.body.appendChild(confetti);

                // アニメーションが終わったら要素を削除
                setTimeout(() => {
                    confetti.remove();
                }, 3000);
            }
        }
    </script>
</body>
</html>
